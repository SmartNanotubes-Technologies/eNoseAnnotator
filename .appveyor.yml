branches:
  only:
    - master

image: Visual Studio 2015
install:
  - set QTDIR=C:\Qt\5.13.2\mingw73_32
  - choco install -y InnoSetup
  - set PATH=%QTDIR%\bin;C:\Qt\Tools\mingw730_32\bin;%PATH%;"C:\Program Files (x86)\Inno Setup 5"
build_script:
  - qmake eNoseAnnotator.pro
  - mingw32-make
  - cd
  - cd "app/release/"
  - dir
  - ren app.exe eNoseAnnotator.exe
  - cd ../..
after_build:
  - cd app
  - windeployqt release/eNoseAnnotator.exe
  - rm release/*.o
  - rm release/*.cpp
  - cd ..
  - echo $(APPVEYOR_BUILD_NUMBER)
  - echo $(appveyor_build_number)
  - echo $(APPVEYOR_BUILD_ID)
  - echo $(appveyor_build_id)
  - mkdir eNoseAnnotator_$(appveyor_build_number)
  - mkdir "eNoseAnnotator_$(appveyor_build_number)/eNoseAnnotator_$(appveyor_build_number)/"
  - cp app/release/* "eNoseAnnotator_$(appveyor_build_number)/eNoseAnnotator_$(appveyor_build_number)/"

artifacts:
  - path: eNoseAnnotator_$(APPVEYOR_BUILD_NUMBER)
    type: zip

deploy:
  - provider: GitHub
    name: production
    artifact: eNoseAnnotator_$(appveyor_build_number).zip
    draft: false
    prerelease: false
    auth_token:
      secure: vgEATF2g25z4SRuiZeER1PiOcABqDjPdOilt5Yb0irKOVbhT14kQcPVNQ5UEbQ75
    on:
      APPVEYOR_REPO_TAG: true

